<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Leaflet Map ‚Äî Google-Maps-like Frontend (HTML)</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-sA+e2qFZk6k2v9g3w4u3jVdGqz0m6v1kYfM2q6bU9+M=" crossorigin="" />
  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <!-- Leaflet Draw -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <!-- Leaflet Routing Machine -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.16/dist/leaflet-routing-machine.css" />

  <style>
    :root{--accent:#1a73e8}
    html,body,#map{height:100%;margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:#222}
    #map{position:fixed;inset:0}

    /* Top controls */
    .topbar{position:fixed;left:12px;right:12px;top:12px;display:flex;gap:8px;align-items:center;z-index:1000}
    .search-box{display:flex;flex:1;gap:8px;background:rgba(255,255,255,0.95);padding:8px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.12)}
    .search-box input{flex:1;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:14px}
    .btn{background:var(--accent);color:white;padding:8px 10px;border-radius:6px;border:none;cursor:pointer}
    .btn.secondary{background:#fff;color:#333;border:1px solid #ddd}

    /* Sidebar */
    .sidebar{position:fixed;right:12px;top:72px;width:320px;max-height:70vh;overflow:auto;background:rgba(255,255,255,0.98);border-radius:8px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.12);z-index:1000}
    .sidebar h3{margin:4px 0 8px}
    .place-item{padding:8px;border-bottom:1px solid #f0f0f0}
    .small{font-size:12px;color:#666}

    /* Mobile adjustments */
    @media (max-width:720px){
      .sidebar{right:8px;left:8px;width:auto;top:72px}
      .topbar{left:8px;right:8px}
    }

    /* Search suggestions */
    .suggestions{position:absolute;background:#fff;border:1px solid #e6e6e6;border-radius:6px;padding:6px;margin-top:6px;max-height:260px;overflow:auto;width:100%}
    .suggestions button{display:block;width:100%;text-align:left;padding:8px;border-radius:6px;border:none;background:transparent}
    .suggestions button:hover{background:#f5f8ff}

    /* Small helpers */
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="topbar">
    <div class="search-box" style="position:relative;">
      <input id="search" placeholder="Search places or addresses (type & press Enter)..." autocomplete="off" />
      <button id="btn-geolocate" class="btn secondary" title="Go to my location">üìç</button>
      <button id="btn-route" class="btn" title="Start routing">Route</button>
      <div id="suggestions" class="suggestions" style="display:none"></div>
    </div>
    <button id="btn-layer" class="btn secondary">Layers</button>
    <button id="btn-saveview" class="btn secondary">Share View</button>
  </div>

  <div class="sidebar" id="sidebar">
    <h3>Places & Favorites</h3>
    <div id="placesList"><div class="small muted">No places yet ‚Äî search and click results to add.</div></div>
    <hr />
    <h3>Routing</h3>
    <div class="small muted">Click two points on map (or use 'Route' then click) to get directions.</div>
    <div id="routeInstructions"></div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-o9N1j7gG3bqJ2GQKJ4zBq1bXk1t0c8sKkWv+3yDkP4o=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.16/dist/leaflet-routing-machine.js"></script>

  <script>
    // Simple HTML-only mapping app using Leaflet + OSM tiles + public services.
    // No API keys required. Feel free to edit tile providers or swap services.

    // --- Map & Layers ---
    const street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19, attribution: '&copy; OpenStreetMap contributors'});
    const topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {maxZoom: 17, attribution: '¬© OpenTopoMap contributors'});
    const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {maxZoom: 19, attribution: 'Tiles ¬© Esri'});

    const map = L.map('map', {layers: [street], zoomControl: true, center: [20.5937,78.9629], zoom: 5});

    const baseLayers = { 'Street': street, 'Topographic': topo, 'Satellite': satellite };
    L.control.layers(baseLayers, null, {collapsed:true}).addTo(map);

    // --- Marker cluster group ---
    const markers = L.markerClusterGroup();
    map.addLayer(markers);

    // --- Load view from URL params (share link) ---
    function readViewFromURL(){
      const p = new URLSearchParams(window.location.search);
      const lat = parseFloat(p.get('lat'));
      const lon = parseFloat(p.get('lon'));
      const z = parseInt(p.get('z'));
      if (!isNaN(lat) && !isNaN(lon) && !isNaN(z)) map.setView([lat,lon],z);
    }
    readViewFromURL();

    // --- Search (Nominatim) with simple autocomplete ---
    const searchInput = document.getElementById('search');
    const suggestions = document.getElementById('suggestions');
    let searchTimeout = null;
    searchInput.addEventListener('input', ()=>{
      const q = searchInput.value.trim();
      if (searchTimeout) clearTimeout(searchTimeout);
      if (!q){suggestions.style.display='none'; return}
      searchTimeout = setTimeout(()=>fetchSuggestions(q),300);
    });

    async function fetchSuggestions(q){
      try{
        const url = `https://nominatim.openstreetmap.org/search?format=jsonv2&q=${encodeURIComponent(q)}&addressdetails=1&limit=6`;
        const res = await fetch(url,{headers:{'Accept':'application/json'}});
        const data = await res.json();
        renderSuggestions(data);
      }catch(e){console.error(e)}
    }
    function renderSuggestions(items){
      suggestions.innerHTML='';
      if (!items || items.length===0){suggestions.style.display='none';return}
      items.forEach(it=>{
        const btn = document.createElement('button');
        btn.textContent = it.display_name;
        btn.onclick = ()=>{
          suggestions.style.display='none';
          addPlaceFromSearch(it);
        };
        suggestions.appendChild(btn);
      });
      suggestions.style.display='block';
    }

    // When user presses Enter, search and zoom to first result
    searchInput.addEventListener('keydown', async (e)=>{
      if (e.key==='Enter'){
        e.preventDefault();
        const q = searchInput.value.trim();
        if (!q) return;
        const url = `https://nominatim.openstreetmap.org/search?format=jsonv2&q=${encodeURIComponent(q)}&addressdetails=1&limit=1`;
        const res = await fetch(url); const data = await res.json();
        if (data && data[0]) addPlaceFromSearch(data[0]);
      }
    });

    // --- Place handling ---
    const placesList = document.getElementById('placesList');
    let savedPlaces = JSON.parse(localStorage.getItem('places_v1')||'[]');
    function savePlaces(){ localStorage.setItem('places_v1', JSON.stringify(savedPlaces)); renderPlaces(); }
    function renderPlaces(){
      placesList.innerHTML = '';
      if (savedPlaces.length===0){placesList.innerHTML='<div class="small muted">No places yet ‚Äî search and click results to add.</div>';return}
      savedPlaces.forEach((p,idx)=>{
        const div = document.createElement('div'); div.className='place-item';
        div.innerHTML = `<strong>${p.name}</strong><div class="small">${p.desc||''}</div>`;
        div.onclick = ()=>{ map.setView([p.lat,p.lon],15) }
        const btn = document.createElement('button'); btn.textContent='Remove'; btn.style.float='right'; btn.onclick=(e)=>{e.stopPropagation(); savedPlaces.splice(idx,1); savePlaces(); }
        div.appendChild(btn);
        placesList.appendChild(div);
      });
    }
    renderPlaces();

    function addPlaceFromSearch(item){
      const lat = parseFloat(item.lat), lon = parseFloat(item.lon);
      const name = item.display_name.split(',')[0];
      const place = {name:name, desc:item.display_name, lat, lon};
      savedPlaces.unshift(place); if (savedPlaces.length>50) savedPlaces.pop(); savePlaces();
      const m = L.marker([lat,lon]); m.bindPopup(`<strong>${name}</strong><br/><small>${item.display_name}</small><br/><button onclick=\"window.postMessage({type:'addFav',lat:${lat},lon:${lon},name:${JSON.stringify(name)},desc:${JSON.stringify(item.display_name)}),true\">Add to favorites</button>`);
      markers.addLayer(m); map.setView([lat,lon],15);
    }

    // Listen for postMessage from popup buttons (quick hack)
    window.addEventListener('message', (ev)=>{
      if (ev.data && ev.data.type==='addFav'){
        savedPlaces.unshift({name:ev.data.name,desc:'',lat:ev.data.lat,lon:ev.data.lon}); savePlaces();
      }
    });

    // --- Geolocation ---
    document.getElementById('btn-geolocate').addEventListener('click', ()=>{
      if (!navigator.geolocation) return alert('Geolocation not available');
      navigator.geolocation.getCurrentPosition(pos=>{
        const lat=pos.coords.latitude, lon=pos.coords.longitude; map.setView([lat,lon],15);
        const m = L.circleMarker([lat,lon],{radius:8,fill:true,fillColor:'#1a73e8',color:'#fff',weight:2}).addTo(map);
        setTimeout(()=>map.removeLayer(m),5000);
      }, err=>alert('Unable to get location: '+err.message));
    });

    // --- Save / share view ---
    document.getElementById('btn-saveview').addEventListener('click', ()=>{
      const c = map.getCenter(); const z = map.getZoom();
      const url = new URL(window.location.href); url.searchParams.set('lat', c.lat.toFixed(6)); url.searchParams.set('lon', c.lng.toFixed(6)); url.searchParams.set('z', z);
      navigator.clipboard.writeText(url.toString()).then(()=>alert('Share link copied to clipboard'))
    });

    // --- Routing (simple two-click route using OSRM) ---
    let routingControl = null; let routePoints = [];
    const routeInstructions = document.getElementById('routeInstructions');
    document.getElementById('btn-route').addEventListener('click', ()=>{
      routePoints = []; routeInstructions.innerHTML='Click two points on the map to get a route.';
      map.once('click', (e)=>{ routePoints.push([e.latlng.lng,e.latlng.lat]); L.marker(e.latlng).addTo(map); map.once('click', (e2)=>{ routePoints.push([e2.latlng.lng,e2.latlng.lat]); showRoute(); })});
    });
    function showRoute(){
      if (routePoints.length<2) return; const from = routePoints[0], to = routePoints[1];
      const url = `https://router.project-osrm.org/route/v1/driving/${from[0]},${from[1]};${to[0]},${to[1]}?overview=full&geometries=geojson&steps=true`;
      fetch(url).then(r=>r.json()).then(data=>{
        if (!data.routes || !data.routes[0]) return alert('No route found');
        const coords = data.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]);
        if (routingControl) map.removeControl(routingControl);
        const routeLine = L.polyline(coords,{color:'#1a73e8',weight:5,opacity:0.8}).addTo(map);
        map.fitBounds(routeLine.getBounds());
        // instructions
        const legs = data.routes[0].legs || [];
        routeInstructions.innerHTML = '';
        legs.forEach((leg,li)=>{
          leg.steps.forEach((s,si)=>{
            const d = document.createElement('div'); d.className='small'; d.textContent = `${s.maneuver.instruction} ‚Äî ${Math.round(s.distance)} m`; routeInstructions.appendChild(d);
          });
        });
      }).catch(e=>{console.error(e); alert('Routing error')});
    }

    // --- Draw & measure tools ---
    const drawnItems = new L.FeatureGroup(); map.addLayer(drawnItems);
    const drawControl = new L.Control.Draw({ position: 'topleft', draw: {circle:false,marker:true,polyline:true,polygon:true,rectangle:true}, edit: { featureGroup: drawnItems } });
    map.addControl(drawControl);
    map.on(L.Draw.Event.CREATED, function (e) { const layer = e.layer; drawnItems.addLayer(layer); if(layer instanceof L.Polygon){ const area = L.GeometryUtil.geodesicArea(layer.getLatLngs()[0]); alert('Area ‚âà '+Math.round(area)+' m¬≤'); } if(layer instanceof L.Polyline){ const dist = 0; } });

    // --- Keyboard shortcuts for zoom & locate ---
    window.addEventListener('keydown', (e)=>{
      if (e.key==='+'||e.key==='=') map.zoomIn();
      if (e.key==='-') map.zoomOut();
      if (e.key==='g') document.getElementById('btn-geolocate').click();
    });

    // --- Add some demo markers (sample POIs) ---
    const samplePOIs = [
      {name:'Taj Mahal', lat:27.1751, lon:78.0421},
      {name:'Gateway of India', lat:18.9219, lon:72.8347},
      {name:'India Gate', lat:28.6129, lon:77.2295}
    ];
    samplePOIs.forEach(p=>{ const m=L.marker([p.lat,p.lon]).bindPopup(`<strong>${p.name}</strong>`); markers.addLayer(m); });

    // --- Fit to markers ---
    if (markers.getLayers().length) map.fitBounds(markers.getBounds().pad(0.2));

    // --- Small UX: hide suggestions when clicking outside ---
    document.addEventListener('click', (e)=>{ if (!document.querySelector('.search-box').contains(e.target)) suggestions.style.display='none'; });

    // --- Expose a small API for debugging ---
    window._map = map; window._markers = markers;

    // --- Final notes ---
    console.log('Map UI ready ‚Äî no API keys needed. Features: search (Nominatim), routing (OSRM public), draw/measure, clustering, layers, geolocation, save favorites (localStorage), share view.');
  </script>
</body>
</html>
