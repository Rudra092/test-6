<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NaviPro - Advanced Interactive Maps</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <!-- Leaflet Routing Machine -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.css" />
    
    <style>
        :root {
            --primary-blue: #2563eb;
            --primary-blue-light: #3b82f6;
            --primary-blue-dark: #1d4ed8;
            --secondary-purple: #7c3aed;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --danger-red: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-purple) 100%);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .sidebar {
            width: 420px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 0 24px 24px 0;
            padding: 24px;
            z-index: 1000;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar.collapsed {
            transform: translateX(-370px);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-purple));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .toggle-btn {
            background: var(--gray-100);
            border: none;
            border-radius: 12px;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--gray-600);
            font-size: 18px;
        }

        .toggle-btn:hover {
            background: var(--gray-200);
            color: var(--gray-800);
            transform: scale(1.05);
        }

        .search-section {
            margin-bottom: 28px;
        }

        .input-group {
            position: relative;
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px 16px 48px;
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            color: var(--gray-800);
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: var(--gray-400);
        }

        .current-location-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-blue);
            border: none;
            border-radius: 8px;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.3s ease;
        }

        .current-location-btn:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-50%) scale(1.1);
        }

        .transport-modes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .transport-btn {
            padding: 16px 8px;
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
        }

        .transport-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-blue-light);
        }

        .transport-btn.active {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
            color: white;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }

        .transport-icon {
            font-size: 24px;
        }

        .route-card {
            background: linear-gradient(135deg, var(--gray-50), white);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--gray-200);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .route-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .route-time {
            font-size: 32px;
            font-weight: 900;
            color: var(--primary-blue);
            display: flex;
            align-items: baseline;
            gap: 4px;
        }

        .route-time-unit {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-600);
        }

        .route-distance {
            color: var(--gray-700);
            font-size: 18px;
            font-weight: 600;
        }

        .traffic-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .traffic-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse-traffic 2s infinite;
        }

        .traffic-indicator.light { background: var(--success-green); }
        .traffic-indicator.moderate { background: var(--warning-orange); }
        .traffic-indicator.heavy { background: var(--danger-red); }

        .traffic-text {
            font-weight: 600;
            color: var(--gray-700);
        }

        .route-options {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .route-option-btn {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .route-option-btn:hover {
            border-color: var(--primary-blue);
            background: rgba(37, 99, 235, 0.05);
        }

        .route-option-btn.active {
            border-color: var(--primary-blue);
            background: var(--primary-blue);
            color: white;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .primary-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(37, 99, 235, 0.4);
        }

        .secondary-btn {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            background: white;
            color: var(--gray-700);
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .secondary-btn:hover {
            border-color: var(--primary-blue);
            background: rgba(37, 99, 235, 0.05);
            transform: translateY(-1px);
        }

        .map-container {
            flex: 1;
            position: relative;
            border-radius: 24px 0 0 24px;
            overflow: hidden;
            margin: 16px 16px 16px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .map-controls {
            position: absolute;
            top: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .control-btn {
            width: 56px;
            height: 56px;
            border: none;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            color: var(--gray-700);
            font-weight: 600;
        }

        .control-btn:hover {
            background: white;
            transform: scale(1.05);
            color: var(--primary-blue);
        }

        .navigation-panel {
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 32px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            display: none;
            align-items: center;
            gap: 20px;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .navigation-panel.active {
            display: flex;
        }

        .speed-display {
            font-size: 28px;
            font-weight: 900;
            color: var(--primary-blue);
            display: flex;
            align-items: baseline;
            gap: 4px;
        }

        .speed-unit {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
        }

        .eta-info {
            color: var(--gray-700);
            font-weight: 600;
        }

        .status-bar {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 16px 24px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success-green);
            animation: pulse-status 1.5s ease-in-out infinite;
        }

        .status-text {
            font-weight: 600;
            color: var(--gray-700);
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px;
            margin-top: 4px;
            max-height: 240px;
            overflow-y: auto;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1001;
            border: 1px solid var(--gray-200);
        }

        .suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--gray-100);
            color: var(--gray-700);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .suggestion-item:hover {
            background: rgba(37, 99, 235, 0.05);
            color: var(--primary-blue);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-icon {
            color: var(--gray-400);
            font-size: 16px;
        }

        @keyframes pulse-traffic {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        @keyframes pulse-status {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        .navigation-instruction {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(37, 99, 235, 0.95);
            color: white;
            padding: 20px 32px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: 700;
            display: none;
            z-index: 1001;
            box-shadow: 0 12px 40px rgba(37, 99, 235, 0.3);
            animation: slideIn 0.5s ease;
        }

        .navigation-instruction.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) translateY(0);
            }
        }

        @media (max-width: 968px) {
            .sidebar {
                width: 100%;
                position: absolute;
                z-index: 2000;
                border-radius: 0;
                height: 100%;
            }
            
            .map-container {
                margin: 0;
                border-radius: 0;
            }
        }

        /* Custom Leaflet Marker Styles */
        .current-location-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            animation: pulse-location 2s infinite;
        }

        @keyframes pulse-location {
            0% { 
                transform: scale(1);
                box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 4px 20px rgba(37, 99, 235, 0.6);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar" id="sidebar">
            <div class="header">
                <div class="logo">
                    <div class="logo-icon">🗺️</div>
                    <div class="logo-text">NaviPro</div>
                </div>
                <button class="toggle-btn" onclick="toggleSidebar()">
                    ☰
                </button>
            </div>

            <div class="search-section">
                <div class="input-group">
                    <div class="input-icon">🚩</div>
                    <input type="text" class="search-input" id="fromInput" placeholder="From location" oninput="showSuggestions(this, 'fromSuggestions')">
                    <button class="current-location-btn" onclick="getCurrentLocation('from')" title="Use current location">
                        📍
                    </button>
                    <div class="suggestions" id="fromSuggestions"></div>
                </div>
                
                <div class="input-group">
                    <div class="input-icon">🎯</div>
                    <input type="text" class="search-input" id="toInput" placeholder="To destination" oninput="showSuggestions(this, 'toSuggestions')">
                    <button class="current-location-btn" onclick="getCurrentLocation('to')" title="Use current location">
                        📍
                    </button>
                    <div class="suggestions" id="toSuggestions"></div>
                </div>
            </div>

            <div class="transport-modes">
                <div class="transport-btn active" onclick="selectTransport(this, 'driving')">
                    <div class="transport-icon">🚗</div>
                    <span>Car</span>
                </div>
                <div class="transport-btn" onclick="selectTransport(this, 'walking')">
                    <div class="transport-icon">🚶</div>
                    <span>Walk</span>
                </div>
                <div class="transport-btn" onclick="selectTransport(this, 'cycling')">
                    <div class="transport-icon">🚴</div>
                    <span>Bike</span>
                </div>
                <div class="transport-btn" onclick="selectTransport(this, 'transit')">
                    <div class="transport-icon">🚌</div>
                    <span>Transit</span>
                </div>
            </div>

            <div class="route-card" id="routeCard">
                <div class="route-summary">
                    <div class="route-time" id="routeTime">
                        25<span class="route-time-unit">min</span>
                    </div>
                    <div class="route-distance" id="routeDistance">8.2 km</div>
                </div>
                
                <div class="traffic-info" id="trafficInfo">
                    <div class="traffic-indicator light" id="trafficIndicator"></div>
                    <div class="traffic-text" id="trafficText">Light traffic on route</div>
                </div>
                
                <div class="route-options">
                    <button class="route-option-btn active" onclick="selectRouteOption(this, 'fastest')">
                        ⚡ Fastest
                    </button>
                    <button class="route-option-btn" onclick="selectRouteOption(this, 'shortest')">
                        📏 Shortest
                    </button>
                </div>
            </div>

            <div class="action-buttons">
                <button class="primary-btn" onclick="getDirections()" id="directionsBtn">
                    🧭 Get Directions
                </button>
                <button class="secondary-btn" onclick="startNavigation()" id="navigationBtn" style="display: none;">
                    ▶️ Start Navigation
                </button>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
            
            <div class="map-controls">
                <button class="control-btn" onclick="zoomIn()" title="Zoom In">+</button>
                <button class="control-btn" onclick="zoomOut()" title="Zoom Out">−</button>
                <button class="control-btn" onclick="centerOnLocation()" title="My Location">📍</button>
                <button class="control-btn" onclick="toggleMapView()" title="Toggle View">🛰️</button>
            </div>

            <div class="navigation-panel" id="navigationPanel">
                <div class="speed-display" id="speedDisplay">
                    45<span class="speed-unit">km/h</span>
                </div>
                <div class="eta-info">
                    ETA: <span id="etaTime">3:47 PM</span>
                </div>
            </div>

            <div class="navigation-instruction" id="navigationInstruction">
                Turn right in 200m
            </div>

            <div class="status-bar">
                <div class="status-indicator" id="statusIndicator"></div>
                <div class="status-text" id="statusText">GPS Connected • Ready for navigation</div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
    
    <script>
        // Global variables
        let map;
        let currentLocationMarker;
        let routeControl;
        let selectedTransport = 'driving';
        let isNavigating = false;
        let currentRoute = null;
        let userLocation = null;
        let navigationInterval;
        let currentStep = 0;
        let isSatelliteView = false;

        // Sample locations for suggestions
        const locations = [
            { name: 'Times Square, New York', coords: [40.7580, -73.9855] },
            { name: 'Central Park, New York', coords: [40.7829, -73.9654] },
            { name: 'Brooklyn Bridge, New York', coords: [40.7061, -73.9969] },
            { name: 'Statue of Liberty, New York', coords: [40.6892, -74.0445] },
            { name: 'Empire State Building', coords: [40.7484, -73.9857] },
            { name: 'Golden Gate Bridge, San Francisco', coords: [37.8199, -122.4783] },
            { name: 'Hollywood Boulevard, Los Angeles', coords: [34.1016, -118.3295] },
            { name: 'Navy Pier, Chicago', coords: [41.8919, -87.6051] },
            { name: 'Space Needle, Seattle', coords: [47.6205, -122.3493] },
            { name: 'Miami Beach, Florida', coords: [25.7907, -80.1300] }
        ];

        // Navigation instructions for simulation
        const navigationInstructions = [
            "Start driving on Main Street",
            "Turn right onto Oak Avenue in 500m",
            "Continue straight for 2.1km",
            "Turn left at the traffic light",
            "Take the highway entrance on the right",
            "Keep left at the fork",
            "Take exit 15 in 3km",
            "Turn right onto Elm Street",
            "Turn left onto Pine Avenue",
            "Destination will be on your right"
        ];

        // Initialize the application
        function initializeApp() {
            initializeMap();
            setupEventListeners();
            getCurrentLocation();
            updateDateTime();
            setInterval(updateDateTime, 60000); // Update every minute
        }

        // Initialize the map
        function initializeMap() {
            map = L.map('map').setView([40.7589, -73.9851], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Custom map styling
            map.getContainer().style.filter = 'brightness(0.9) contrast(1.1) saturate(1.2)';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.input-group')) {
                    document.querySelectorAll('.suggestions').forEach(s => s.classList.remove('active'));
                }
            });

            // Real-time updates simulation
            setInterval(simulateRealTimeUpdates, 3000);
        }

        // Get current location
        function getCurrentLocation(type = null) {
            if (navigator.geolocation) {
                updateStatus('Getting your location...');
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        userLocation = [lat, lng];
                        
                        if (type === 'from') {
                            document.getElementById('fromInput').value = 'Current Location';
                            reverseGeocode(lat, lng, 'fromInput');
                        } else if (type === 'to') {
                            document.getElementById('toInput').value = 'Current Location';
                            reverseGeocode(lat, lng, 'toInput');
                        } else {
                            // Initial location setup
                            map.setView([lat, lng], 15);
                            addCurrentLocationMarker([lat, lng]);
                            updateStatus('Location found • GPS connected');
                        }
                    },
                    (error) => {
                        console.error('Error getting location:', error);
                        updateStatus('Location access denied');
                        // Fallback to default location (New York)
                        const defaultLocation = [40.7589, -73.9851];
                        map.setView(defaultLocation, 13);
                        addCurrentLocationMarker(defaultLocation);
                        userLocation = defaultLocation;
                    }
                );
            }
        }

        // Add current location marker
        function addCurrentLocationMarker(coords) {
            if (currentLocationMarker) {
                map.removeLayer(currentLocationMarker);
            }
            
            const customIcon = L.divIcon({
                className: 'current-location-marker',
                html: '',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });

            currentLocationMarker = L.marker(coords, { icon: customIcon }).addTo(map);
        }

        // Reverse geocoding to get address from coordinates
        async function reverseGeocode(lat, lng, inputId) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                const data = await response.json();
                if (data.display_name) {
                    document.getElementById(inputId).value = data.display_name.split(',')[0];
                }
            } catch (error) {
                console.error('Reverse geocoding failed:', error);
            }
        }

        // Show location suggestions
        function showSuggestions(input, suggestionsId) {
            const suggestions = document.getElementById(suggestionsId);
            const query = input.value.toLowerCase();
            
            if (query.length < 2) {
                suggestions.classList.remove('active');
                return;
            }

            const filtered = locations.filter(location => 
                location.name.toLowerCase().includes(query)
            );

            suggestions.innerHTML = filtered.slice(0, 6).map(location => 
                `<div class="suggestion-item" onclick="selectSuggestion('${input.id}', '${location.name}', '${suggestionsId}', [${location.coords}])">
                    <span class="suggestion-icon">📍</span>
                    <span>${location.name}</span>
                </div>`
            ).join('');

            suggestions.classList.add('active');
        }

        // Select suggestion
        function selectSuggestion(inputId, locationName, suggestionsId, coords) {
            document.getElementById(inputId).value = locationName;
            document.getElementById(suggestionsId).classList.remove('active');
            
            // Store coordinates for routing
            document.getElementById(inputId).dataset.coords = JSON.stringify(coords);
            
            // Show route if both locations are set
            if (document.getElementById('fromInput').value && document.getElementById('toInput').value) {
                updateDirectionsButton();
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }

        // Select transport mode
        function selectTransport(element, mode) {
            document.querySelectorAll('.transport-btn').forEach(btn => 
                btn.classList.remove('active')
            );
            element.classList.add('active');
            selectedTransport = mode;
            updateRouteInfo(mode);
            
            if (currentRoute) {
                getDirections(); // Refresh route with new transport mode
            }
        }

        // Update route information based on transport mode
        function updateRouteInfo(mode) {
            const routeData = {
                driving: { time: '25', unit: 'min', distance: '8.2 km', traffic: 'light', trafficText: 'Light traffic on route' },
                walking: { time: '1h 45m', unit: '', distance: '6.8 km', traffic: 'light', trafficText: 'Pedestrian-friendly route' },
                cycling: { time: '42', unit: 'min', distance: '7.1 km', traffic: 'light', trafficText: 'Bike lanes available' },
                transit: { time: '38', unit: 'min', distance: '9.5 km', traffic: 'moderate', trafficText: 'Next bus: 5 minutes' }
            };

            const data = routeData[mode];
            document.getElementById('routeTime').innerHTML = `${data.time}<span class="route-time-unit">${data.unit}</span>`;
            document.getElementById('routeDistance').textContent = data.distance;
            document.getElementById('trafficIndicator').className = `traffic-indicator ${data.traffic}`;
            document.getElementById('trafficText').textContent = data.trafficText;
        }

        // Select route option
        function selectRouteOption(element, option) {
            document.querySelectorAll('.route-option-btn').forEach(btn => 
                btn.classList.remove('active')
            );
            element.classList.add('active');
            
            if (currentRoute) {
                getDirections(); // Refresh route with new option
            }
        }

        // Get directions
        function getDirections() {
            const fromInput = document.getElementById('fromInput');
            const toInput = document.getElementById('toInput');
            
            if (!fromInput.value || !toInput.value) {
                updateStatus('Please enter both start and destination');
                return;
            }

            updateStatus('Calculating route...');
            
            // Get coordinates
            let fromCoords, toCoords;
            
            if (fromInput.value === 'Current Location' && userLocation) {
                fromCoords = userLocation;
            } else if (fromInput.dataset.coords) {
                fromCoords = JSON.parse(fromInput.dataset.coords);
            } else {
                // Default to user location or NYC
                fromCoords = userLocation || [40.7589, -73.9851];
            }
            
            if (toInput.dataset.coords) {
                toCoords = JSON.parse(toInput.dataset.coords);
            } else {
                // Default destination (example: Central Park)
                toCoords = [40.7829, -73.9654];
            }

            // Remove existing route
            if (routeControl) {
                map.removeControl(routeControl);
            }

            // Create new route
            routeControl = L.Routing.control({
                waypoints: [
                    L.latLng(fromCoords[0], fromCoords[1]),
                    L.latLng(toCoords[0], toCoords[1])
                ],
                routeWhileDragging: false,
                addWaypoints: false,
                createMarker: function(i, waypoint, n) {
                    const isStart = i === 0;
                    const iconHtml = isStart ? '🚩' : '🎯';
                    const className = isStart ? 'route-marker-start' : 'route-marker-end';
                    
                    return L.marker(waypoint.latLng, {
                        icon: L.divIcon({
                            className: className,
                            html: `<div style="background: ${isStart ? '#10b981' : '#ef4444'}; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">${iconHtml}</div>`,
                            iconSize: [30, 30],
                            iconAnchor: [15, 15]
                        })
                    });
                },
                lineOptions: {
                    styles: [{
                        color: '#2563eb',
                        weight: 6,
                        opacity: 0.8
                    }]
                },
                show: false, // Hide default instructions panel
                router: L.Routing.osrmv1({
                    serviceUrl: `https://router.project-osrm.org/route/v1/${selectedTransport}`
                })
            }).addTo(map);

            routeControl.on('routesfound', function(e) {
                currentRoute = e.routes[0];
                updateStatus('Route calculated successfully');
                document.getElementById('navigationBtn').style.display = 'block';
                document.getElementById('directionsBtn').textContent = '🔄 Update Route';
                
                // Update route info with actual data
                const totalTime = Math.round(currentRoute.summary.totalTime / 60);
                const totalDistance = (currentRoute.summary.totalDistance / 1000).toFixed(1);
                
                document.getElementById('routeTime').innerHTML = `${totalTime}<span class="route-time-unit">min</span>`;
                document.getElementById('routeDistance').textContent = `${totalDistance} km`;
            });

            routeControl.on('routingerror', function(e) {
                updateStatus('Route calculation failed');
                console.error('Routing error:', e);
            });
        }

        // Start navigation
        function startNavigation() {
            if (!currentRoute) {
                updateStatus('Please get directions first');
                return;
            }

            if (!isNavigating) {
                isNavigating = true;
                currentStep = 0;
                
                document.getElementById('navigationBtn').innerHTML = '⏹️ Stop Navigation';
                document.getElementById('navigationPanel').classList.add('active');
                updateStatus('Navigation started');
                
                // Start navigation simulation
                simulateNavigation();
            } else {
                stopNavigation();
            }
        }

        // Stop navigation
        function stopNavigation() {
            isNavigating = false;
            currentStep = 0;
            
            if (navigationInterval) {
                clearInterval(navigationInterval);
            }
            
            document.getElementById('navigationBtn').innerHTML = '▶️ Start Navigation';
            document.getElementById('navigationPanel').classList.remove('active');
            document.getElementById('navigationInstruction').classList.remove('active');
            updateStatus('Navigation stopped');
        }

        // Simulate navigation
        function simulateNavigation() {
            if (!isNavigating) return;
            
            // Show first instruction
            showNavigationInstruction(navigationInstructions[currentStep]);
            
            navigationInterval = setInterval(() => {
                if (!isNavigating) return;
                
                currentStep++;
                if (currentStep >= navigationInstructions.length) {
                    // Navigation completed
                    showNavigationInstruction('You have arrived at your destination!');
                    setTimeout(() => {
                        stopNavigation();
                        updateStatus('Destination reached');
                    }, 3000);
                    return;
                }
                
                showNavigationInstruction(navigationInstructions[currentStep]);
            }, 8000); // Change instruction every 8 seconds
        }

        // Show navigation instruction
        function showNavigationInstruction(instruction) {
            const instructionElement = document.getElementById('navigationInstruction');
            instructionElement.textContent = instruction;
            instructionElement.classList.add('active');
            
            // Hide after 4 seconds
            setTimeout(() => {
                instructionElement.classList.remove('active');
            }, 4000);
        }

        // Map controls
        function zoomIn() {
            map.zoomIn();
        }

        function zoomOut() {
            map.zoomOut();
        }

        function centerOnLocation() {
            if (userLocation) {
                map.setView(userLocation, 16);
                updateStatus('Centered on your location');
            } else {
                getCurrentLocation();
            }
        }

        function toggleMapView() {
            if (!isSatelliteView) {
                // Switch to satellite view
                map.eachLayer((layer) => {
                    if (layer._url && layer._url.includes('openstreetmap')) {
                        map.removeLayer(layer);
                    }
                });
                
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles © Esri',
                    maxZoom: 19
                }).addTo(map);
                
                isSatelliteView = true;
                updateStatus('Switched to satellite view');
            } else {
                // Switch back to street view
                map.eachLayer((layer) => {
                    if (layer._url && layer._url.includes('arcgisonline')) {
                        map.removeLayer(layer);
                    }
                });
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(map);
                
                isSatelliteView = false;
                updateStatus('Switched to street view');
            }
        }

        // Update status
        function updateStatus(message) {
            document.getElementById('statusText').textContent = message;
            
            // Auto-revert to default status after 3 seconds
            setTimeout(() => {
                if (isNavigating) {
                    document.getElementById('statusText').textContent = 'Navigation active • GPS tracking';
                } else {
                    document.getElementById('statusText').textContent = 'GPS Connected • Ready for navigation';
                }
            }, 3000);
        }

        // Update directions button state
        function updateDirectionsButton() {
            const btn = document.getElementById('directionsBtn');
            if (document.getElementById('fromInput').value && document.getElementById('toInput').value) {
                btn.classList.add('primary-btn');
                btn.innerHTML = '🧭 Get Directions';
            }
        }

        // Simulate real-time updates
        function simulateRealTimeUpdates() {
            if (isNavigating) {
                // Update speed randomly
                const speeds = [38, 42, 45, 48, 52, 55, 41, 46];
                const randomSpeed = speeds[Math.floor(Math.random() * speeds.length)];
                document.getElementById('speedDisplay').innerHTML = `${randomSpeed}<span class="speed-unit">km/h</span>`;
                
                // Update traffic randomly
                const trafficStates = [
                    { class: 'light', text: 'Light traffic ahead' },
                    { class: 'moderate', text: 'Moderate traffic detected' },
                    { class: 'light', text: 'Traffic clearing up' }
                ];
                
                const randomTraffic = trafficStates[Math.floor(Math.random() * trafficStates.length)];
                document.getElementById('trafficIndicator').className = `traffic-indicator ${randomTraffic.class}`;
                
                // Occasionally update status with navigation info
                if (Math.random() < 0.3) {
                    const navUpdates = [
                        'GPS signal strong',
                        'Recalculating route...',
                        'Faster route found',
                        'Traffic updated'
                    ];
                    updateStatus(navUpdates[Math.floor(Math.random() * navUpdates.length)]);
                }
            }
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const eta = new Date(now.getTime() + (25 * 60000)); // 25 minutes from now
            document.getElementById('etaTime').textContent = eta.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit'
            });
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>