<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maps ‚Äî Google-Maps-like (Leaflet)</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.16/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" />

  <style>
    /* Visual style inspired by modern map apps - not an exact copy of Google Maps */
    :root{--blue:#1a73e8;--panel:#ffffff;--muted:#6b7280}
    html,body,#map{height:100%;margin:0;padding:0}
    body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:#111}
    #map{height:100vh}

    /* Top center search bar */
    .search-wrap{position:fixed;left:50%;transform:translateX(-50%);top:14px;z-index:1400;width:min(760px,92%)}
    .search-card{display:flex;gap:8px;align-items:center;background:var(--panel);padding:8px;border-radius:8px;box-shadow:0 6px 18px rgba(15,23,42,0.12)}
    .search-card input{flex:1;padding:10px;border-radius:6px;border:1px solid #e6e6e6;font-size:15px}
    .search-actions{display:flex;gap:6px}
    .btn{background:var(--blue);color:#fff;padding:8px 10px;border-radius:6px;border:none;cursor:pointer;font-weight:600}
    .btn.ghost{background:#fff;color:#333;border:1px solid #e6e6e6}

    /* Left directions panel (mimics side panel) */
    .panel{position:fixed;left:12px;top:72px;width:360px;max-height:78vh;overflow:auto;background:var(--panel);border-radius:10px;padding:12px;box-shadow:0 8px 30px rgba(2,6,23,0.12);z-index:1200}
    .panel h2{margin:4px 0 8px;font-size:18px}
    .field{display:flex;gap:6px;align-items:center;margin-bottom:8px}
    .field input{flex:1;padding:8px;border-radius:6px;border:1px solid #e6e6e6}
    .directions-instr{font-size:13px;color:var(--muted);margin-top:8px}
    .place-card{padding:8px;border-radius:8px;border:1px solid #f2f4f7;margin-bottom:8px}

    /* Right floating control cluster (zoom, layers, locate) */
    .controls{position:fixed;right:12px;bottom:12px;display:flex;flex-direction:column;gap:8px;z-index:1300}
    .control-btn{width:46px;height:46px;border-radius:10px;background:var(--panel);display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(2,6,23,0.12);border:1px solid #e6e6e6;cursor:pointer}
    .control-btn.small{width:40px;height:40px}

    /* Mobile adjustments */
    @media (max-width:820px){
      .panel{left:8px;right:8px;width:auto;top:82px}
      .search-wrap{top:8px}
      .controls{right:8px}
    }

    /* Suggestions dropdown */
    .suggestions{position:absolute;background:#fff;border:1px solid #eee;border-radius:8px;padding:6px;margin-top:6px;max-height:260px;overflow:auto;width:100%;box-shadow:0 8px 30px rgba(2,6,23,0.06)}
    .suggestions button{display:block;width:100%;text-align:left;padding:10px;border-radius:6px;border:none;background:transparent}
    .suggestions button:hover{background:#f6f9ff}

    .muted{color:var(--muted)}
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="search-wrap">
    <div class="search-card">
      <input id="search" placeholder="Search for places, addresses or businesses" autocomplete="off" />
      <div class="search-actions">
        <button id="btn-search" class="btn">Search</button>
        <button id="btn-clear" class="btn ghost">Clear</button>
      </div>
      <div id="suggestions" class="suggestions" style="display:none"></div>
    </div>
  </div>

  <div class="panel" id="leftPanel">
    <h2>Directions</h2>
    <div class="field"><input id="from" placeholder="Choose starting point" /><button id="swap" class="control-btn small" title="Swap">‚áÖ</button></div>
    <div class="field"><input id="to" placeholder="Choose destination" /></div>
    <div style="display:flex;gap:8px;margin-bottom:8px"><button id="btn-getdirections" class="btn">Get Directions</button><button id="btn-clearroute" class="btn ghost">Clear</button></div>
    <div id="directionsResult" class="directions-instr">Route instructions will appear here.</div>
  </div>

  <div class="controls" aria-hidden="false">
    <div class="control-btn" id="btn-locate" title="Your location">üìç</div>
    <div class="control-btn" id="btn-zoom-in" title="Zoom in">Ôºã</div>
    <div class="control-btn" id="btn-zoom-out" title="Zoom out">Ôºç</div>
    <div class="control-btn" id="btn-layer" title="Toggle layers">üó∫Ô∏è</div>
    <div class="control-btn" id="btn-full" title="Fullscreen">‚§¢</div>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.16/dist/leaflet-routing-machine.js"></script>
  <script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js"></script>

  <script>
    // Google-Maps-like single-file app built with Leaflet and open services.
    // NOTE: This intentionally avoids duplicating Google Maps' proprietary UI exactly, but provides a similar UX.

    // --- Map & layers ---
    const street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'¬© OpenStreetMap contributors'});
    const sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{maxZoom:19,attribution:'Tiles ¬© Esri'});
    const topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',{maxZoom:17,attribution:'¬© OpenTopoMap contributors'});

    const map = L.map('map',{center:[20.5937,78.9629],zoom:5,layers:[street],zoomControl:false});
    L.control.scale().addTo(map);
    L.control.fullscreen({position:'topright'}).addTo(map);

    // Custom simple layer toggle (sat/street)
    let currentBase = 'street';
    document.getElementById('btn-layer').addEventListener('click', ()=>{
      if (currentBase==='street'){ map.addLayer(sat); map.removeLayer(street); currentBase='sat'; } else { map.addLayer(street); map.removeLayer(sat); currentBase='street'; }
    });

    // Basic zoom buttons
    document.getElementById('btn-zoom-in').addEventListener('click', ()=>map.zoomIn());
    document.getElementById('btn-zoom-out').addEventListener('click', ()=>map.zoomOut());

    // --- Marker clustering & demo POIs ---
    const markers = L.markerClusterGroup(); map.addLayer(markers);
    const demo = [
      {name:'Taj Mahal',lat:27.1751,lon:78.0421},
      {name:'India Gate',lat:28.6129,lon:77.2295},
      {name:'Gateway of India',lat:18.9219,lon:72.8347}
    ];
    demo.forEach(d=>{ const m=L.marker([d.lat,d.lon]); m.bindPopup(`<strong>${d.name}</strong>`); markers.addLayer(m); });
    if (markers.getLayers().length) map.fitBounds(markers.getBounds().pad(0.2));

    // --- Search (Nominatim) with autocomplete & place cards ---
    const searchInput = document.getElementById('search'); const suggestions = document.getElementById('suggestions');
    let searchTimeout=null;
    searchInput.addEventListener('input', ()=>{ const q=searchInput.value.trim(); if (searchTimeout) clearTimeout(searchTimeout); if (!q){suggestions.style.display='none'; return} searchTimeout=setTimeout(()=>fetchSuggestions(q),250); });

    async function fetchSuggestions(q){
      try{
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=jsonv2&q=${encodeURIComponent(q)}&addressdetails=1&limit=6`);
        const data = await res.json(); renderSuggestions(data);
      }catch(e){console.error(e)}
    }
    function renderSuggestions(items){ suggestions.innerHTML=''; if (!items || items.length===0){suggestions.style.display='none'; return} items.forEach(it=>{ const btn=document.createElement('button'); btn.textContent=it.display_name; btn.onclick=()=>selectPlace(it); suggestions.appendChild(btn); }); suggestions.style.display='block'; }

    function selectPlace(it){ suggestions.style.display='none'; searchInput.value = it.display_name.split(',')[0]; const lat=parseFloat(it.lat), lon=parseFloat(it.lon); const m=L.marker([lat,lon],{draggable:true}).addTo(map); m.bindPopup(`<strong>${it.display_name.split(',')[0]}</strong><div class=\"muted\">${it.display_name}</div><div style=\"margin-top:8px\"><button onclick=\"window.postMessage({type:'savePlace',name:${JSON.stringify(it.display_name.split(',')[0])},lat:${lat},lon:${lon}}, '*')\">Save</button></div>`).openPopup(); map.setView([lat,lon],15); markers.addLayer(m); }

    // Listen for saving from popup
    window.addEventListener('message',(ev)=>{ if (ev.data && ev.data.type==='savePlace'){ const p=ev.data; const list = JSON.parse(localStorage.getItem('gm_like_places')||'[]'); list.unshift(p); localStorage.setItem('gm_like_places', JSON.stringify(list)); alert('Saved place: '+p.name); } });

    // Clear search
    document.getElementById('btn-clear').addEventListener('click', ()=>{ searchInput.value=''; suggestions.style.display='none'; });

    // Enter key -> first result
    searchInput.addEventListener('keydown', async (e)=>{ if (e.key === 'Enter'){ e.preventDefault(); const q=searchInput.value.trim(); if (!q) return; const res = await fetch(`https://nominatim.openstreetmap.org/search?format=jsonv2&q=${encodeURIComponent(q)}&addressdetails=1&limit=1`); const data = await res.json(); if (data && data[0]) selectPlace(data[0]); } });

    // Hide suggestions when clicking outside
    document.addEventListener('click', (e)=>{ if (!document.querySelector('.search-card').contains(e.target)) suggestions.style.display='none'; });

    // --- Geolocation (center on user) ---
    document.getElementById('btn-locate').addEventListener('click', ()=>{ if (!navigator.geolocation) return alert('Geolocation not available'); navigator.geolocation.getCurrentPosition(pos=>{ const lat=pos.coords.latitude, lon=pos.coords.longitude; map.setView([lat,lon],15); const c=L.circleMarker([lat,lon],{radius:8,fill:true,fillColor:varOr('#0b67ff','#1a73e8'),color:'#fff',weight:2}).addTo(map); setTimeout(()=>map.removeLayer(c),4000); }, err=>alert('Unable to get location: '+err.message)); });
    function varOr(a,b){return a||b}

    // --- Directions (OSRM) ---
    let routing = null;
    const fromInput = document.getElementById('from'); const toInput = document.getElementById('to'); const directionsDiv = document.getElementById('directionsResult');

    document.getElementById('btn-getdirections').addEventListener('click', ()=>{
      const a = fromInput.value.trim(); const b = toInput.value.trim(); if (!a || !b) return alert('Please enter both origin and destination'); geocodeThenRoute(a,b);
    });
    document.getElementById('btn-clearroute').addEventListener('click', ()=>{ if (routing){ map.removeControl(routing); routing=null; } directionsDiv.innerHTML='Route instructions will appear here.'; });
    document.getElementById('swap').addEventListener('click', ()=>{ const t=fromInput.value; fromInput.value=toInput.value; toInput.value=t; });

    async function geocodeThenRoute(a,b){ try{
      const [ra,rb] = await Promise.all([geocode(a), geocode(b)]);
      if (!ra || !rb) return alert('Could not geocode one of the addresses'); routeBetween([ra.lon,ra.lat],[rb.lon,rb.lat]);
    }catch(e){console.error(e)} }

    async function geocode(q){ const res = await fetch(`https://nominatim.openstreetmap.org/search?format=jsonv2&q=${encodeURIComponent(q)}&limit=1`); const data = await res.json(); return data && data[0] ? {lat:parseFloat(data[0].lat), lon:parseFloat(data[0].lon)} : null; }

    function routeBetween(from,to){
      if (routing){ map.removeControl(routing); routing=null; }
      routing = L.Routing.control({ waypoints: [L.latLng(from[1],from[0]), L.latLng(to[1],to[0])], router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }), showAlternatives:false, lineOptions:{styles:[{color:varOr('#0b67ff','#1a73e8'),opacity:0.9,weight:6}] }, addWaypoints:false, routeWhileDragging:false }).addTo(map);
      routing.on('routesfound', function(e){ const routes = e.routes; if (routes && routes[0]){ const instrs = []; routes[0].instructions = routes[0].instructions || []; // some versions
        // build instruction list from summary legs
        let html = `<div class=\"place-card\"><strong>Distance:</strong> ${(routes[0].summary.totalDistance/1000).toFixed(2)} km ‚Äî <strong>Time:</strong> ${(routes[0].summary.totalTime/60).toFixed(0)} min</div>`;
        html += '<ol>';
        const steps = routes[0].instructions ? routes[0].instructions : [];
        // Fallback: use legs/steps if available
        if (routes[0].waypointIndexes) { /* noop */ }
        // Use OSRM data via backend fetch for human-readable steps: call OSRM directly
        fetch(`https://router.project-osrm.org/route/v1/driving/${from[0]},${from[1]};${to[0]},${to[1]}?overview=false&steps=true`).then(r=>r.json()).then(d=>{
          if (d.routes && d.routes[0]){
            const legs = d.routes[0].legs || [];
            let out = '';
            legs.forEach(leg=>{ leg.steps.forEach(s=>{ out += `<li>${s.maneuver.instruction} ‚Äî ${Math.round(s.distance)} m</li>`; }); });
            directionsDiv.innerHTML = html + '<ol>' + out + '</ol>';
          }
        }).catch(err=>{ console.error(err); directionsDiv.innerHTML = html + '<div class="muted">No step-by-step available.</div>'; });
      }});
    }

    // --- Draw tools (measure) ---
    const drawn = new L.FeatureGroup(); map.addLayer(drawn);
    const drawCtrl = new L.Control.Draw({ position:'topleft', draw:{circle:false,marker:false,polyline:true,polygon:true,rectangle:true}, edit:{featureGroup:drawn} });
    map.addControl(drawCtrl);
    map.on(L.Draw.Event.CREATED, function(e){ const layer = e.layer; drawn.addLayer(layer); if (layer instanceof L.Polygon){ const area = L.GeometryUtil.geodesicArea(layer.getLatLngs()[0]); alert('Area ‚âà '+Math.round(area)+' m¬≤'); } if (layer instanceof L.Polyline){ const len = 0; /*could calculate*/ } });

    // --- Keyboard shortcuts ---
    window.addEventListener('keydown',(e)=>{ if (e.key==='+'||e.key==='=') map.zoomIn(); if (e.key==='-') map.zoomOut(); if (e.key==='f') document.getElementById('btn-full').click(); if (e.key==='g') document.getElementById('btn-locate').click(); });

    // --- Small helpers ---
    function addDemoMarkers(){}

    // Expose map for debugging
    window._map = map; window._markers = markers;

    console.log('Google-Maps-like app ready. For Street View or Google Places features you will need Google APIs (API key + billing). This version uses open-source services (Nominatim, OSRM, OSM tiles).');
  </script>
</body>
</html>
